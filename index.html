<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, #d1d5db, #f3f4f6);
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 1rem;
        }
        .card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        .input-group label {
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container p-4">

        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Attendance Tracker</h1>
            <p class="text-gray-600 mt-2">Apni attendance record karein</p>
        </header>

        <!-- Main Card -->
        <div id="main-card" class="card">
            <h2 class="text-xl font-bold mb-4 text-gray-700">Attendance Record</h2>
            
            <!-- Date Input -->
            <div class="mb-4">
                <label for="date" class="block text-sm font-medium text-gray-700">Date</label>
                <input type="date" id="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
            </div>

            <!-- Time Inputs -->
            <div class="flex gap-4 mb-4">
                <div class="flex-1">
                    <label for="inTime" class="block text-sm font-medium text-gray-700">In Time</label>
                    <input type="time" id="inTime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                </div>
                <div class="flex-1">
                    <label for="outTime" class="block text-sm font-medium text-gray-700">Out Time</label>
                    <input type="time" id="outTime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                </div>
            </div>

            <!-- Salary Settings -->
            <div class="mb-4">
                <label for="hourlyRate" class="block text-sm font-medium text-gray-700">Salary Per Hour</label>
                <input type="number" id="hourlyRate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" value="10">
            </div>

            <!-- Buttons -->
            <div class="flex gap-4">
                <button id="saveBtn" class="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Save
                </button>
                <button id="viewBtn" class="flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    View Performance
                </button>
            </div>
        </div>

        <!-- Performance Overview Card -->
        <div id="performance-card" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-gray-700">Performance Overview</h2>
            
            <div class="space-y-4">
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium text-gray-600">Total Present Days:</span>
                    <span id="totalPresentDays" class="font-bold text-lg text-blue-600">0</span>
                </div>
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium text-gray-600">Total Hours:</span>
                    <span id="totalHours" class="font-bold text-lg text-green-600">0</span>
                </div>
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium text-gray-600">Overtime Hours:</span>
                    <span id="totalOvertimeHours" class="font-bold text-lg text-yellow-600">0</span>
                </div>
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <span class="font-medium text-gray-600">Salary:</span>
                    <span id="totalSalary" class="font-bold text-lg text-purple-600">Rs. 0</span>
                </div>
            </div>

            <div class="mt-6 flex gap-4">
                <button id="backBtn" class="flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Back
                </button>
                <button id="copyBtn" class="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Copy to Clipboard
                </button>
                <button id="clearBtn" class="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Clear Data
                </button>
            </div>
        </div>
        
        <!-- Message Box for user notifications -->
        <div id="messageBox" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-sm px-4 py-2 rounded-lg opacity-0 transition-opacity duration-300"></div>

    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const saveBtn = document.getElementById('saveBtn');
            const viewBtn = document.getElementById('viewBtn');
            const backBtn = document.getElementById('backBtn');
            const copyBtn = document.getElementById('copyBtn');
            const clearBtn = document.getElementById('clearBtn');
            const dateInput = document.getElementById('date');
            const inTimeInput = document.getElementById('inTime');
            const outTimeInput = document.getElementById('outTime');
            const hourlyRateInput = document.getElementById('hourlyRate');
            const mainCard = document.getElementById('main-card');
            const performanceCard = document.getElementById('performance-card');
            const totalPresentDaysElement = document.getElementById('totalPresentDays');
            const totalHoursElement = document.getElementById('totalHours');
            const totalOvertimeHoursElement = document.getElementById('totalOvertimeHours');
            const totalSalaryElement = document.getElementById('totalSalary');
            const messageBox = document.getElementById('messageBox');

            const ATTENDANCE_KEY = 'attendanceData';

            function showMessage(message) {
                messageBox.textContent = message;
                messageBox.classList.remove('opacity-0');
                messageBox.classList.add('opacity-100');
                setTimeout(() => {
                    messageBox.classList.remove('opacity-100');
                    messageBox.classList.add('opacity-0');
                }, 3000);
            }

            function loadEntries() {
                const data = localStorage.getItem(ATTENDANCE_KEY);
                return data ? JSON.parse(data) : [];
            }

            function saveEntries(entries) {
                localStorage.setItem(ATTENDANCE_KEY, JSON.stringify(entries));
            }

            function calculateTimeAndSalary(attendance) {
                let totalMinutes = 0;
                let totalPresentDays = 0;
                let totalOvertimeMinutes = 0;
                const dailyWorkingMinutes = 8 * 60; // 8 hours in minutes
                const hourlyRate = parseFloat(hourlyRateInput.value) || 0;
                const overtimeRate = hourlyRate * 1.5;

                for (const record of attendance) {
                    if (record.inTime && record.outTime) {
                        totalPresentDays++;
                        
                        const [inHour, inMinute] = record.inTime.split(':').map(Number);
                        const [outHour, outMinute] = record.outTime.split(':').map(Number);

                        let dailyMinutes = (outHour * 60 + outMinute) - (inHour * 60 + inMinute);

                        if (dailyMinutes < 0) {
                            dailyMinutes += 24 * 60; // Handle overnight shifts
                        }

                        totalMinutes += dailyMinutes;

                        if (dailyMinutes > dailyWorkingMinutes) {
                            totalOvertimeMinutes += dailyMinutes - dailyWorkingMinutes;
                        }
                    }
                }

                const totalHours = Math.floor(totalMinutes / 60);
                const totalOvertimeHours = Math.floor(totalOvertimeMinutes / 60);
                const totalSalary = ((totalHours - totalOvertimeHours) * hourlyRate) + (totalOvertimeHours * overtimeRate);

                return {
                    totalHours: totalHours,
                    totalOvertimeHours: totalOvertimeHours,
                    totalPresentDays: totalPresentDays,
                    totalSalary: totalSalary
                };
            }

            function renderPerformance() {
                const entries = loadEntries();
                const stats = calculateTimeAndSalary(entries);

                totalPresentDaysElement.textContent = stats.totalPresentDays;
                totalHoursElement.textContent = stats.totalHours;
                totalOvertimeHoursElement.textContent = stats.totalOvertimeHours;
                totalSalaryElement.textContent = `Rs. ${stats.totalSalary.toFixed(2)}`;
            }

            saveBtn.addEventListener('click', () => {
                const date = dateInput.value;
                const inTime = inTimeInput.value;
                const outTime = outTimeInput.value;

                if (!date || !inTime || !outTime) {
                    showMessage('Please fill all the fields.');
                    return;
                }

                const entries = loadEntries();
                entries.push({ date, inTime, outTime });
                saveEntries(entries);
                showMessage('Attendance saved successfully!');
                dateInput.value = '';
                inTimeInput.value = '';
                outTimeInput.value = '';
                
                // Update performance view if it's visible
                if (!performanceCard.classList.contains('hidden')) {
                    renderPerformance();
                }
            });

            viewBtn.addEventListener('click', () => {
                renderPerformance();
                mainCard.classList.add('hidden');
                performanceCard.classList.remove('hidden');
            });

            backBtn.addEventListener('click', () => {
                mainCard.classList.remove('hidden');
                performanceCard.classList.add('hidden');
            });

            copyBtn.addEventListener('click', () => {
                const entries = loadEntries();
                if (entries.length === 0) {
                    showMessage('No data to copy.');
                    return;
                }
                const stats = calculateTimeAndSalary(entries);
                const textToCopy = `Total Present Days: ${stats.totalPresentDays}\nTotal Hours: ${stats.totalHours}\nOvertime Hours: ${stats.totalOvertimeHours}\nTotal Salary: Rs. ${stats.totalSalary.toFixed(2)}\n\n--- Detailed Records ---\n${JSON.stringify(entries, null, 2)}`;
                
                const tempTextarea = document.createElement('textarea');
                tempTextarea.value = textToCopy;
                document.body.appendChild(tempTextarea);
                tempTextarea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextarea);

                showMessage('Data copied to clipboard!');
            });

            clearBtn.addEventListener('click', () => {
                localStorage.removeItem(ATTENDANCE_KEY);
                renderPerformance(); // Reset display
                showMessage('All data has been cleared.');
            });
        });
    </script>
</body>
</html>
